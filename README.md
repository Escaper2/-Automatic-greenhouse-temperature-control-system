
Система автоматического регулирования температуры воздуха в теплице
===================================================================
&nbsp;&nbsp;&nbsp;&nbsp;Всем привет. Проект будет полезен тем, у кого есть дача, а на даче имеется теплица. В нем я разработал терморегулятор, который автоматически регулирует температуру воздуха в теплице.

<p align="center">

  <img src=images/68e56d5e035f630a3b863.png>
<br><br>
</b>			
<b align="center">
3D вид печатной платы терморегулятора
</b>
</p>
<br><br>

# Системы автоматического регулирования

&nbsp;&nbsp;&nbsp;&nbsp;Эта работа основана на таком понятии, как системы автоматического регулирования (САР) - динамические системы, которые стабилизируют или изменяют (по известной или неизвестной программе) регулируемую величину. В качестве регулируемого параметра для моего случая, была выбрана температура воздуха в теплице. Наиболее простая техническая реализация такой САР представлена в книге Б.А. Карташова *Компьютерные технологии и микропроцессорные средства в автоматическом управлении*. Выглядит она вот так:

<p align="center">

  <img src=images/cba4314948bc9a2c65e5e.png>
<br><br>
</b>			
<b align="center">
Функциональная схема САР температуры воздуха в теплице
</b>
</p>  



&nbsp;&nbsp;&nbsp;&nbsp;Подробно ознакомиться с этой схемой и прочитать как она работает можно [здесь](https://pandia.ru/text/80/335/33148-18.php). Но если кратко, то при изменении температуры меняется сопротивление терморезистора, которое приводит к формированию сигнала рассогласования напряжений (на мостовой схеме и терморезисторе), а этот сигнал приходит на исполнительный механизм, который обеспечивает открытие и закрытие фрамуги (форточки)

Для постройки САР температуры воздуха в теплице были выбраны следующие основные элементы:

\- термостат LM56 (считывает температуру в теплице, а также посылает сигналы о превышении двух заданных порогов температур: минимальной и максимальной, пороги также задаются с помощью него);
<p align="center">

  <img src=images/802890a8ca9f32f314ca1.png>
<br><br>
</b>			
<b align="center">
Схема термостата LM56
</b>
</p>  


\- драйвер двигателя L293D (для управления двигателем: открытие/закрытие фрамуги);

\- микросхема «Логического НЕ» 74HC04D (для инвертирования сигнала о минимальной температуре, чтобы обеспечить корректную работу драйвера двигателя).

# Разработка схемы и логики устройства

&nbsp;&nbsp;&nbsp;&nbsp;В качестве основы используется схема САР, изображенная на рисунке выше, НО мостовая схема и терморезистор заменяются термостатом LM56 с интегрированным цифровым датчиком температуры. Далее, к данному термостату подключаются резисторы R1, R2 и R3, необходимые для установки пороговой температуры срабатывания термостата, и соответственно электродвигателя. Также на данный термостат подключается питание, и выходит два вывода, служащих для передачи сигнала на драйвер L293D, которые соединяются с цепью питания через резисторы номиналом 100кОм. Сама цепь питания на своём пути имеет два ключа, один для экстренной остановки всей САР, обозначенный на рисунке ниже (Структурная схема САР) номером \[1\], а другой для переключения между автоматическим режимом поддержания температуры в теплице и ручным режимом поддержания температуры в теплице, обозначенный номером \[2\].

&nbsp;&nbsp;&nbsp;&nbsp;Через микросхему «Логического НЕ» 74HC04D проходит первый проводник, идущий от термостата LM56 на драйвер L293D. Сама микросхема «Логического НЕ» 74HC04D служит для инвертирования сигнала, поступающего с термостата на драйвер. Также в данной цепи, соединяющей термостат и драйвер, используется два ключа, которые подключены как к проводникам, несущим сигнал между термостатом и драйвером, так и к питанию, идущему на термостат, они обозначены номерами \[3\] и \[4\]. Данные ключи необходимы для использования ручного режима, а в частности управления вращением двигателя в одну или другую сторону, с целью открытия или закрытия фрамуги.

&nbsp;&nbsp;&nbsp;&nbsp;На входы драйвера L293D подается два сигнала, второй идущий напрямую от термостата LM56, а первый прошедший инвертирование через микросхему 74HC04D. Данные сигналы служат для управления двигателем – вращение в одну или другую сторону, с целью открытия или закрытия фрамуги. Также драйвер L293D соединяется с источником питания, который имеет напряжение 5 вольт и служит для питания термостата, драйвера и микросхемы, а также, через отдельный клеммник, к нему подводится питание для силовой части питания двигателя.  Драйвер L293D управляет двигателем, используя 3 и 6 выходы. Структурная схема автоматизированной САР представлена на рисунке ниже.

<p align="center">

  <img src=images/ee6b03e5bb55fd30207fe.png>
<br><br>
</b>			
<b align="center">
Рисунок 4. Структурная схема САР
</b>
</p>  




&nbsp;&nbsp;&nbsp;&nbsp;Сопротивление резистора R3 служит для установки минимальной температуры. Его номинал в 11,5 кОм, подобранный при помощи формул, приведённых в даташите микросхемы, позволяет задать нижний порог температуры равный 22°С. Учитывая то, что термостат LM56 имеет гистерезис равный 5°С, требуемая минимальная температура для комфортного выращивания огурцов равная 17°С будет поддерживаться. По достижению 17°С сигнал будет подан на двигатель, и фрамуга закроется для поддержания тепла в теплице. Сопротивление резистора R2, служит для установки максимальной температуры в теплице. Его номинал в 380 Ом, подобранный при помощи формул, приведенных в даташите микросхемы, позволяет задать верхний порог температуры равный 25°С. Благодаря чему требуемая максимальная температура для комфортного выращивания огурцов равная 25°С будет поддерживаться. По достижению 26°С, сигнал будет подан на двигатель, и фрамуга откроется для проветривания и понижения температуры в теплице.

<p align="center">

  <img src=images/e5e73499dc0e820fed61d.png>
<br><br>
</b>			
<b align="center">
Формулы для расчета сопротивлений, необходимых для  
настраивания нужных порогов температуры  
</b>
</p>  




&nbsp;&nbsp;&nbsp;&nbsp;Данные формулы позволяют перевести минимальную и максимальную температуру в сопротивления резисторов R3 и R2 с коэффициентом 6.20мВ на 1°С и смещением на 395мВ.

&nbsp;&nbsp;&nbsp;&nbsp;Инвертор, изображенный на рисунке 4, а в процессе разработки заменённый на микросхему «Логического НЕ» 74HC04D, служит для инвертирования сигнала, поступающего с выхода термостата LM56, обозначающего достижение минимальной температуры. Он необходим в связи с тем, что при достижении температуры в 26°С, с выходов термостата LM56 будет подаваться два нулевых сигнала, что не даст двигателю вращаться. А при комфортной температуре 22°С, с выхода 6 будет подан единичный сигнал, так как допустимый порог в 25°С не превышен, а с 7 выхода будет подан ноль, так как минимальная температура в 22°С превышена, такая комбинация сигналов приведет к вращению двигателя и открытию фрамуги, что нам не нужно при комфортной температуре в теплице.

&nbsp;&nbsp;&nbsp;&nbsp;При установке 74HC04D на выход 7 с термостата LM56 будут достигнуты необходимые сигналы, поступающие с термостата LM56 на драйвер L293D. Так при комфортной температуре внутри теплицы, сигнал с выхода 7 при помощи микросхемы «Логического НЕ» будет инвертирован, что не даст двигателю вращаться, т.к. на входах драйвера будет две единицы. Так же и с температурой, превышающей максимальную комфортную –с выхода 6 термостата LM56 будет подан нулевой сигнал на драйвер L293D, а вот нулевой сигнал с выхода 7 термостата LM56 не будет подан благодаря инвертору, что приведет к открытию фрамуги двигателем, т.к. на входах драйвера двигателя будет 0 и 1. В ситуации, когда температура будет равной 17°С, с выхода 6 термостата LM56 будет подан единичный сигнал, а сигнал с выхода 7 термостата LM56, благодаря микросхеме «Логического НЕ» будет инвертирован в нулевой сигнал, поданный на драйвер L293D с целью закрытия фрамуги. Данные процессы представлены в таблице ниже. 


<p align="center">

  <img src=images/edf5191f246140597756b.png>
<br><br>
</b>			
<b align="center">
Таблица срабатывания САР. Сигналы, приходящие на драйвер L293D 
</b>
</p> 


&nbsp;&nbsp;&nbsp;&nbsp;Резисторы с номиналом 100кОм, соединяющие выходы 7 и 6 с термостата LM56 и питание, служат для способствования формирования логического уровня и поддержания нужного тока, так как максимально возможный выход тока с термостата LM56 ограничен 50 микроамперами. При использовании ручного режима посредством переведения ключа \[2\] в положение ручного режима, мы можем изменять положение ключа \[3\] для открытия фрамуги, или изменять положения ключа \[4\] для закрытия фрамуги. В случае экстренной ситуации, в данной САР предусмотрена ключ остановки всех процессов, обозначенный на рисунке 4 номером \[1\]. При размыкание данного ключа, поступление питания на термостат LM56, драйвер L293D и микросхему «Логического НЕ» 74HC04D перестаёт подаваться, и как следствие все процессы, протекающие в САР, прекращают свою работу. 

# Разработка платы терморегулятора

&nbsp;&nbsp;&nbsp;&nbsp;Исходя из подобранных элементов и задач была составлена принципиальная схема терморегулятора в программе Altium Designer 19.

<p align="center">

  <img src=images/9354988c156f4f2a3da19.png>
<br><br>
</b>			
<b align="center">
Принципиальная схема терморегулятора
</b>
</p> 

&nbsp;&nbsp;&nbsp;&nbsp;Схема состоит из трех блоков: первый блок – блок микросхем, осуществляющих управление терморегулятором, второй блок – блок конденсаторов, стабилизирующих напряжения и частоты, третий блок – это клемники, один из которых отвечает за питание схемы, второй за питание для двигателя, а третий за подключение платы терморегулятора к двигателю.

&nbsp;&nbsp;&nbsp;&nbsp;После составления принципиальной схемы по ней была сделана и разведена печатная плата терморегулятора, в программе Altium Designer 19:

<p align="center">

  <img src=images/0c5b063fb1a370ce9acf3.png>
<br><br>
</b>			
<b align="center">
Печатная плата терморегулятора
</b>
</p> 


&nbsp;&nbsp;&nbsp;&nbsp;Размеры платы, следующие: 40.88 миллиметров по горизонтали и 61.55 миллиметров по вертикали.

&nbsp;&nbsp;&nbsp;&nbsp;Плата состоит из двух слоев: Top Layer и Bottom Layer. Дорожки платы в основном находятся на слое Top Layer, несколько дорожек на Bottom Layer. 

&nbsp;&nbsp;&nbsp;&nbsp;К обоим слоям подключен полигон GND, также на плате распределена Via Stitching Group, подключенная к земле, все это сделано для лучшего распределения земли на плате


<p align="center">

  <img src=images/026235524a9c357f3f992.png>
<br><br>
</b>			
<b align="center">
Слой Top Layer печатной платы терморегулятора
</b>
</p>



<p align="center">

  <img src=images/b3500f73a761e5372d5c9.png>
<br><br>
</b>			
<b align="center">
Слой Bottom Layer печатной платы терморегулятора
</b>
</p>


&nbsp;&nbsp;&nbsp;&nbsp;Внешний вид платы в 3D представлен ниже
<p align="center">

  <img src=images/2cef08723b9e9ca8e97e0.png>
<br><br>
</b>			
<b align="center">
Внешний вид платы в 3D
</b>
</p>


&nbsp;&nbsp;&nbsp;&nbsp;В итоге была разработана полностью рабочая плата для управления двигателем и поддержанием необходимого диапазона температуры в теплице. Режимы ручного и автоматического управления представлены ключами S1, S2, S3, S4. Плата имеет небольшой размер, что является несомненным плюсом при её монтаже.
